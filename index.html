<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Weather Monitoring System</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <style>
        #map { height: 600px; }
        .control-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            background: white;
            padding: 10px;
            z-index: 1000;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .polygon-label {
            font-weight: bold;
            font-size: 12px;
            color: black;
        }
    </style>
</head>
<body>
    <h1>Global Weather Monitoring System</h1>
    <div id="map"></div>

    <div class="control-panel">
        <h3>Control Panel</h3>
        <input type="password" id="password" placeholder="Enter password" />
        <button onclick="validatePassword()">Login</button>
        <div id="alert-controls" style="display: none;">
            <h4>Issue Weather Alert</h4>
            <select id="alert-type">
                <option value="tornado">Tornado Warning (Red)</option>
                <option value="pds-tornado">PDS Tornado Warning (Pink)</option>
                <option value="hail-core">Hail Core (Pink, Small)</option>
                <option value="heavy-rain">Heavy Rain Warning (Red)</option>
                <option value="flash-flood">Flash Flood Warning (Blue)</option>
                <option value="coastal-flood">Coastal Flood Warning (Teal)</option>
                <option value="freeze">Freeze Alert (Light Blue)</option>
                <option value="heat-wave">Heat Wave Alert (Orange)</option>
                <option value="intense-rain">Intense Rain (Orange)</option>
                <option value="moderate-rain">Moderate Rain (Yellow)</option>
                <option value="light-rain">Light Rain (Green)</option>
                <option value="lightest-rain">Lightest Rain (Light Green)</option>
                <option value="unknown">Unknown Weather Statement (Gray)</option>
            </select>
            <input type="number" id="expiration-time" placeholder="Time to expire (hours)" />
            <button onclick="setAddingPolygon(true)">Select Location</button>
            <button onclick="addPolygon()">Add Polygon</button>
            <button onclick="deleteLastPolygon()">Delete Last Polygon</button>
        </div>
    </div>

    <script>
        const map = L.map('map').setView([39.8283, -98.5795], 5); // Center on the U.S.

        // Add base map layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // Colors for different weather types
        const weatherColors = {
            'tornado': 'red',
            'pds-tornado': 'pink',
            'hail-core': 'pink',
            'heavy-rain': 'red',
            'flash-flood': 'blue',
            'coastal-flood': 'teal',
            'freeze': 'lightblue',
            'heat-wave': 'orange',
            'intense-rain': 'orange',
            'moderate-rain': 'yellow',
            'light-rain': 'green',
            'lightest-rain': 'lightgreen',
            'unknown': 'gray'
        };

        const polygons = []; // Store all polygons for global visibility
        let addingPolygon = false; // Flag to track if polygon creation is active
        let currentClickLocation = null; // Store the last click location for polygon creation
        let ttsAlreadySpoken = false; // To track whether TTS has been spoken to avoid repetition

        // Password validation for control panel access
        function validatePassword() {
            const password = document.getElementById('password').value;
            if (password === "weather123") {
                alert("Access granted!");
                document.getElementById('alert-controls').style.display = 'block';
            } else {
                alert("Invalid password!");
            }
        }

        // Set adding polygon mode on
        function setAddingPolygon(value) {
            addingPolygon = value;
            if (addingPolygon) {
                alert("Click on the map to select the location for the polygon.");
            }
        }

        // Add polygon to map
        function addPolygon() {
            if (!currentClickLocation) {
                alert("Please click a location on the map first.");
                return;
            }

            const alertType = document.getElementById('alert-type').value;
            const color = weatherColors[alertType] || 'gray';
            const expirationTime = document.getElementById('expiration-time').value || 3; // Default to 3 hours

            // Adjust the size of the polygon based on alert type
            let radius = 0.05; // Default size
            switch (alertType) {
                case 'tornado':
                    radius = 0.1; // Larger for tornadoes
                    break;
                case 'pds-tornado':
                    radius = 0.15; // Even larger for PDS tornadoes
                    break;
                case 'hail-core':
                    radius = 0.02; // Smaller for hail core
                    break;
                case 'heavy-rain':
                    radius = 0.1;
                    break;
                // Add more cases as needed
            }

            // Create a circle for the polygon at the clicked position
            const polygon = L.circle(currentClickLocation, { 
                radius: radius * 100000, // Scale radius for visual effect
                color: color, 
                fillColor: color, 
                fillOpacity: 0.5
            }).addTo(map);
            polygons.push(polygon);

            // Add a label to the polygon
            const label = L.marker(currentClickLocation, {
                icon: L.divIcon({
                    className: 'polygon-label',
                    html: `<span>${alertType.replace(/-/g, ' ').toUpperCase()}</span>`
                })
            }).addTo(map);

            // Announce weather alert with TTS, only if not already spoken
            if (!ttsAlreadySpoken) {
                announceAlert(alertType);
                ttsAlreadySpoken = true;
            }

            // Set expiration time for polygon if specified
            const expirationDate = new Date().getTime() + expirationTime * 3600000; // Convert hours to milliseconds
            setTimeout(() => {
                map.removeLayer(polygon);
                map.removeLayer(label);
                alert(`${alertType.replace(/-/g, ' ')} polygon has expired and been removed.`);
            }, expirationTime * 3600000); // Convert hours to milliseconds

            // Reset the adding polygon flag and location
            addingPolygon = false;
            currentClickLocation = null;
        }

        // Delete the last polygon added
        function deleteLastPolygon() {
            if (polygons.length > 0) {
                const lastPolygon = polygons.pop();
                map.removeLayer(lastPolygon);
                alert("Last polygon has been deleted.");
            } else {
                alert("No polygons to delete.");
            }
        }

        // Text-to-speech announcement
        function announceAlert(alertType) {
            const msg = new SpeechSynthesisUtterance(`A ${alertType.replace(/-/g, ' ')} has been issued.`);
            window.speechSynthesis.speak(msg);
        }

        // Add click listener to map to choose the location for the polygon
        map.on('click', function(e) {
            if (addingPolygon) {
                currentClickLocation = e.latlng;
                alert("Location selected. Now click 'Add Polygon' to place it.");
            }
        });
    </script>
</body>
</html>




