<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Weather Monitoring System</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <style>
        #map { height: 600px; }
        .control-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            background: white;
            padding: 10px;
            z-index: 1000;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .polygon-label {
            font-weight: bold;
            font-size: 12px;
            color: black;
        }
    </style>
</head>
<body>
    <h1>Global Weather Monitoring System</h1>
    <div id="map"></div>

    <div class="control-panel">
        <h3>Control Panel</h3>
        <input type="password" id="password" placeholder="Enter password" />
        <button onclick="validatePassword()">Login</button>
        <div id="alert-controls" style="display: none;">
            <h4>Issue Weather Alert</h4>
            <select id="alert-type">
                <option value="tornado">Tornado Warning (Red)</option>
                <option value="pds-tornado">PDS Tornado Warning (Pink)</option>
                <option value="hail-core">Hail Core (Pink, Small)</option>
                <option value="heavy-rain">Heavy Rain Warning (Red)</option>
                <option value="flash-flood">Flash Flood Warning (Blue)</option>
                <option value="coastal-flood">Coastal Flood Warning (Teal)</option>
                <option value="freeze">Freeze Alert (Light Blue)</option>
                <option value="heat-wave">Heat Wave Alert (Orange)</option>
                <option value="intense-rain">Intense Rain (Orange)</option>
                <option value="moderate-rain">Moderate Rain (Yellow)</option>
                <option value="light-rain">Light Rain (Green)</option>
                <option value="lightest-rain">Lightest Rain (Light Green)</option>
                <option value="unknown">Unknown Weather Statement (Gray)</option>
            </select>
            <button onclick="addPolygon()">Add Polygon</button>
        </div>
    </div>

    <script>
        const map = L.map('map').setView([39.8283, -98.5795], 5); // Center on the U.S.

        // Add base map layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // Initialize user location marker
        let userMarker = null;

        // Locate and mark the user's location
        function locateUser() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const userLat = position.coords.latitude;
                    const userLon = position.coords.longitude;

                    if (userMarker) map.removeLayer(userMarker);

                    userMarker = L.marker([userLat, userLon]).addTo(map).bindPopup("You are here!").openPopup();
                    map.setView([userLat, userLon], 10);
                });
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }

        locateUser();

        // Colors for different weather types
        const weatherColors = {
            'tornado': 'red',
            'pds-tornado': 'pink',
            'hail-core': 'pink',
            'heavy-rain': 'red',
            'flash-flood': 'blue',
            'coastal-flood': 'teal',
            'freeze': 'lightblue',
            'heat-wave': 'orange',
            'intense-rain': 'orange',
            'moderate-rain': 'yellow',
            'light-rain': 'green',
            'lightest-rain': 'lightgreen',
            'unknown': 'gray'
        };

        const polygons = []; // Store all polygons for global visibility

        // Password validation for control panel access
        function validatePassword() {
            const password = document.getElementById('password').value;
            if (password === "weather123") {
                alert("Access granted!");
                document.getElementById('alert-controls').style.display = 'block';
            } else {
                alert("Invalid password!");
            }
        }

        // Add polygon to map
        function addPolygon() {
            const alertType = document.getElementById('alert-type').value;
            const color = weatherColors[alertType] || 'gray';

            const bounds = [
                [Math.random() * 10 + 30, Math.random() * -10 - 90], // Randomize coordinates
                [Math.random() * 10 + 40, Math.random() * -20 - 80]
            ];

            const polygon = L.polygon(bounds, { color, fillColor: color, fillOpacity: 0.5 }).addTo(map);
            polygons.push(polygon);

            const label = L.marker(bounds[0], {
                icon: L.divIcon({
                    className: 'polygon-label',
                    html: `<span>${alertType.replace(/-/g, ' ').toUpperCase()}</span>`
                })
            }).addTo(map);

            // Announce weather alert with TTS
            announceAlert(alertType);
        }

        // Text-to-speech announcement
        function announceAlert(alertType) {
            const msg = new SpeechSynthesisUtterance(`A ${alertType.replace(/-/g, ' ')} has been issued.`);
            window.speechSynthesis.speak(msg);
        }

        // Automatically locate the user upon page load
        window.onload = () => locateUser();
    </script>
</body>
</html>



